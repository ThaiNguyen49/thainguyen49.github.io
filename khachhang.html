<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Kh√°ch h√†ng Lin Fu ki·∫øm ƒë√¥i t·ª∑ </title>
<style>
  :root{--bg:#0b1225;--panel:#0f162d;--text:#e6eef8;--muted:#9fb0c6;--border:#1f2937;--accent:#22d3ee}
  *{box-sizing:border-box}
  body{margin:0;background:radial-gradient(1200px 1200px at 0% 0%, #0a0f22, var(--bg));color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial}
  header{padding:16px;border-bottom:1px solid var(--border);background:rgba(11,18,37,.75);backdrop-filter:blur(6px);position:sticky;top:0}
  h1{margin:0;font-size:18px}
  .wrap{max-width:1150px;margin:0 auto;padding:16px}
  .tabs{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
  .tab{padding:8px 12px;border:1px solid var(--border);background:#0c1a33;border-radius:999px;cursor:pointer;font-size:13px}
  .tab.active{outline:2px solid var(--accent)}
  .bar{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
  .btn{padding:8px 12px;border:1px solid var(--border);background:#0c1a33;color:var(--text);border-radius:999px;cursor:pointer}
  .btn.primary{border-color:#1b3b5a;background:#0d223f}
  .cards{display:grid;gap:16px;grid-template-columns:1fr}
  @media(min-width:980px){.cards{grid-template-columns:480px 1fr}}
  .card{background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));border:1px solid var(--border);border-radius:14px}
  .pad{padding:14px}
  label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
  input,textarea,select{width:100%;padding:10px 12px;border-radius:10px;border:1px solid var(--border);background:#0b1329;color:var(--text)}
  textarea{min-height:80px;resize:vertical}
  .grid2{display:grid;gap:10px;grid-template-columns:1fr 1fr}
  .row{display:grid;gap:10px;grid-template-columns:1fr}
  .title{font-weight:700;font-size:20px;margin:0 0 4px}
  .subtitle{color:#b7c5d9;font-size:13px;margin:0 0 10px}
  .kv{margin:6px 0;font-size:14px}
  .kv b{color:#dbe6f6}
  .preview-grid{display:grid;grid-template-columns:110px 1fr;gap:12px}
  .thumb{width:110px;height:110px;border-radius:10px;border:1px solid var(--border);background:#0b1329;display:flex;align-items:center;justify-content:center;overflow:hidden;cursor:pointer}
  .thumb img{width:100%;height:100%;object-fit:cover}
  .status{display:inline-block;margin-left:6px;font-size:11px;padding:4px 8px;border-radius:999px;border:1px solid var(--border);background:#0b1329}
  .lightbox{position:fixed;inset:0;background:rgba(0,0,0,.7);display:none;align-items:center;justify-content:center;padding:20px;z-index:50}
  .lightbox img{max-width:96vw;max-height:90vh;border-radius:12px;border:1px solid var(--border);background:#000}
  .close{position:absolute;top:14px;right:16px;border:1px solid var(--border);background:#111827;color:#fff;border-radius:999px;padding:6px 10px;cursor:pointer}
  .hint{color:var(--muted);font-size:12px}
</style>
</head>
<body>
<header><h1>Kh√°ch h√†ng Lin Fu ki·∫øm ƒë√¥i t·ª∑</h1></header>

<div class="wrap">
  <!-- Tabs + actions -->
  <div class="tabs" id="tabbar"></div>
  <div class="bar">
    <button class="btn primary" id="addTab">‚ûï Th√™m tab</button>
    <button class="btn" id="dupTab">üìÑ Nh√¢n b·∫£n tab</button>
    <button class="btn" id="delTab">üóëÔ∏è Xo√° tab</button>
    <button class="btn" id="exportRO">üîó Xu·∫•t HTML ch·ªâ ƒë·ªçc (tab hi·ªán t·∫°i)</button>
    <span class="hint">N·ªó l·ª±c c≈©ng b·∫±ng th·ª´a.</span>
  </div>

  <div class="cards">
    <!-- FORM -->
    <div class="card">
      <div class="pad">
        <div class="row">
          <div>
            <label>Ng√†y th·ª±c chi·∫øn</label>
            <input id="ngay" type="date">
          </div>
          <div>
            <label>T√™n</label>
            <input id="ten" type="text" placeholder="Nh·∫≠p t√™n‚Ä¶">
          </div>
        </div>

        <div class="grid2">
          <div>
            <label>NƒÉm sinh</label>
            <input id="namsinh" type="number" min="1900" max="2100" placeholder="VD: 1989">
          </div>
          <div>
            <label>N∆°i ·ªü</label>
            <input id="noio" type="text" placeholder="T·ªânh/TP">
          </div>
        </div>

        <div class="grid2">
          <div>
            <label>H√¥n nh√¢n</label>
            <input id="honnhan" type="text" placeholder="ƒê·ªôc th√¢n / K·∫øt h√¥n / Ly h√¥n‚Ä¶">
          </div>
          <div>
            <label>Con c√°i</label>
            <input id="concai" type="text" placeholder="VD: 2 con (8,5 tu·ªïi)">
          </div>
        </div>

        <div class="row">
          <div>
            <label>Nhu c·∫ßu kh√°ch h√†ng</label>
            <textarea id="nhucau" placeholder="Nh·∫≠p nhu c·∫ßu‚Ä¶"></textarea>
          </div>
          <div>
            <label>ƒêang ƒëi h∆∞·ªõng</label>
            <textarea id="huong" placeholder="K·∫ø ho·∫°ch/ƒë·ªãnh h∆∞·ªõng‚Ä¶"></textarea>
          </div>
        </div>

        <!-- M·ªöI: Chi ti·∫øt kh√°ch h√†ng c·∫ßn thi·∫øt ch√∫ tr·ªçng -->
        <div class="row">
          <div>
            <label>Chi Ti·∫øt kh√°ch h√†ng c·∫ßn thi·∫øt ch√∫ tr·ªçng</label>
            <textarea id="chitiet" placeholder="C√°c ƒëi·ªÉm quan tr·ªçng c·∫ßn l∆∞u √Ω, m·ªëc th·ªùi gian, ng∆∞·ªùi li√™n quan, ƒëi·ªÅu ki·ªán ∆∞u ti√™n‚Ä¶"></textarea>
          </div>
        </div>

        <div class="grid2">
          <div>
            <label>Ba m·∫π</label>
            <input id="bame" type="text" placeholder="C√≤n / m·∫•t / ghi ch√∫">
          </div>
          <div>
            <label>Anh ch·ªã em</label>
            <input id="anhchiem" type="text" placeholder="VD: 1 anh, 1 em">
          </div>
        </div>

        <div class="row">
          <div>
            <label>M·ªëi quan h·ªá</label>
            <input id="moiquanhe" type="text" placeholder="B·∫°n b√®/ƒë·ªìng nghi·ªáp/kh√°c‚Ä¶">
          </div>
          <div>
            <label>C√¥ng vi·ªác</label>
            <input id="congviec" type="text" placeholder="VD: Gi√°o vi√™n To√°n THCS">
          </div>
        </div>

        <div class="grid2">
          <div>
            <label>T√†i s·∫£n ti·ªÅn m·∫∑t</label>
            <input id="tienmat" type="text" placeholder="VD: ~200 tri·ªáu">
          </div>
          <div>
            <label>Tr·∫°ng th√°i</label>
            <select id="trangthai">
              <option value="dang">ƒêANG CHƒÇM</option>
              <option value="chet">ƒê√É CH·∫æT</option>
            </select>
          </div>
        </div>

        <div class="grid2">
          <div>
            <label>C√≥ nh√† kh√¥ng</label>
            <select id="nha"><option>C√≥</option><option>Kh√¥ng</option><option>Kh√¥ng r√µ</option></select>
          </div>
          <div>
            <label>C√≥ xe kh√¥ng</label>
            <select id="xe"><option>C√≥</option><option>Kh√¥ng</option><option>Kh√¥ng r√µ</option></select>
          </div>
        </div>

        <div class="row">
          <div>
            <label>C√≥ ƒë·∫•t kh√¥ng</label>
            <select id="dat"><option>C√≥</option><option>Kh√¥ng</option><option>Kh√¥ng r√µ</option></select>
          </div>
        </div>

        <hr style="border:none;border-top:1px solid var(--border);margin:12px 0">
        <div class="row">
          <div>
            <label>·∫¢nh (ch·ªçn file t·ª´ m√°y)</label>
            <input id="file" type="file" accept="image/*">
          </div>
          <div>
            <label>Ho·∫∑c d√°n link ·∫£nh</label>
            <input id="imgurl" type="url" placeholder="https://‚Ä¶">
          </div>
        </div>

        <div class="bar">
          <button class="btn primary" id="capnhat">C·∫≠p nh·∫≠t xem tr∆∞·ªõc</button>
          <button class="btn" id="resetForm">Xo√° tr·∫Øng form</button>
        </div>
        <p class="hint">ƒêi·ªÅn xong b·∫•m <b>C·∫≠p nh·∫≠t xem tr∆∞·ªõc</b>. ·∫¢nh nh·ªè b·∫•m ƒë·ªÉ xem l·ªõn.</p>
      </div>
    </div>

    <!-- PREVIEW -->
    <div class="card">
      <div class="pad">
        <div class="preview-grid">
          <div class="thumb" id="thumb" title="B·∫•m ƒë·ªÉ xem l·ªõn">
            <span style="font-size:12px;color:#9fb0c6;text-align:center;padding:6px">Ch∆∞a c√≥ ·∫£nh</span>
          </div>
          <div>
            <div class="title" id="p-ten">‚Äî</div>
            <div class="subtitle" id="p-sub">NƒÉm sinh ‚Äî ‚Ä¢ N∆°i ·ªü ‚Äî</div>
            <div class="kv"><b>Ng√†y th·ª±c chi·∫øn:</b> <span id="p-ngay">‚Äî</span>
              <span id="p-trangthai" class="status">ƒêANG CHƒÇM</span>
            </div>
            <div class="kv"><b>H√¥n nh√¢n:</b> <span id="p-honnhan">‚Äî</span></div>
            <div class="kv"><b>Con c√°i:</b> <span id="p-concai">‚Äî</span></div>
            <div class="kv"><b>Nhu c·∫ßu kh√°ch h√†ng:</b> <span id="p-nhucau">‚Äî</span></div>
            <div class="kv"><b>ƒêang ƒëi h∆∞·ªõng:</b> <span id="p-huong">‚Äî</span></div>
            <!-- M·ªöI: hi·ªÉn th·ªã chi ti·∫øt ch√∫ tr·ªçng -->
            <div class="kv"><b>Chi Ti·∫øt ch√∫ tr·ªçng:</b> <span id="p-chitiet">‚Äî</span></div>

            <div class="kv"><b>Ba m·∫π:</b> <span id="p-bame">‚Äî</span></div>
            <div class="kv"><b>Anh ch·ªã em:</b> <span id="p-ace">‚Äî</span></div>
            <div class="kv"><b>M·ªëi quan h·ªá:</b> <span id="p-mqh">‚Äî</span></div>
            <div class="kv"><b>C√¥ng vi·ªác:</b> <span id="p-cv">‚Äî</span></div>
            <div class="kv"><b>T√†i s·∫£n ti·ªÅn m·∫∑t:</b> <span id="p-tien">‚Äî</span></div>
            <div class="kv"><b>C√≥ nh√†:</b> <span id="p-nha">‚Äî</span> ‚Ä¢ <b>C√≥ xe:</b> <span id="p-xe">‚Äî</span> ‚Ä¢ <b>C√≥ ƒë·∫•t:</b> <span id="p-dat">‚Äî</span></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- LIGHTBOX -->
<div id="lightbox" class="lightbox" role="dialog" aria-modal="true">
  <button class="close" id="closeLb">ƒê√≥ng</button>
  <img id="bigimg" alt="·∫¢nh ph√≥ng to">
</div>

<script>
/* ====== State & persistence ====== */
const storeKey = "profiles-tabs-v1";
let profiles = [];     // [{id, name, data, image}]
let current = -1;      // index of active tab
const $ = (id)=>document.getElementById(id);

function uid(){ return 'P' + Math.random().toString(36).slice(2,9); }

function load(){
  try{
    const raw = localStorage.getItem(storeKey);
    if(raw){ profiles = JSON.parse(raw); }
  }catch{}
  if(!Array.isArray(profiles) || profiles.length===0){
    profiles = [ {id: uid(), name:"Kh√°ch 1", data:{}, image:""} ];
  }
  current = 0;
}
function save(){ localStorage.setItem(storeKey, JSON.stringify(profiles)); }
function active(){ return profiles[current]; }

/* ====== Tabs UI ====== */
function renderTabs(){
  const bar = $("tabbar");
  bar.innerHTML = "";
  profiles.forEach((p, i)=>{
    const el = document.createElement("button");
    el.className = "tab" + (i===current?" active":"");
    el.textContent = p.name || `Kh√°ch ${i+1}`;
    el.title = p.id;
    el.addEventListener("click", ()=>{ switchTo(i); });
    bar.appendChild(el);
  });
}
function switchTo(i){
  current = i;
  fillForm(active().data, active().image);
  renderTabs();
}

/* ====== Form <-> Data ====== */
const fields = ["ngay","ten","namsinh","noio","honnhan","concai","nhucau","huong","chitiet","bame","anhchiem","moiquanhe","congviec","tienmat"];
const selects = ["trangthai","nha","xe","dat"];
let imageDataURL = "";

function collectForm(){
  const data = {};
  fields.forEach(k=> data[k] = $(k).value );
  selects.forEach(k=> data[k] = $(k).value );
  return {data, image: imageDataURL};
}
function fillForm(data={}, image=""){
  fields.forEach(k=> { $(k).value = data[k] || ""; });
  selects.forEach(k=> { $(k).value = data[k] || $(k).value; });
  imageDataURL = image || "";
  updatePreview();
}
function autosave(){
  const act = active();
  const snap = collectForm();
  act.data = snap.data; act.image = snap.image;
  act.name = act.data.ten || act.name;
  save(); renderTabs();
}

/* ====== Preview ====== */
function updatePreview(){
  const d = active()?.data || {};
  $("p-ten").textContent = d.ten || "‚Äî";
  $("p-sub").textContent = `NƒÉm sinh ${d.namsinh||"‚Äî"} ‚Ä¢ N∆°i ·ªü ${d.noio||"‚Äî"}`;
  $("p-ngay").textContent = d.ngay || "‚Äî";
  $("p-honnhan").textContent = d.honnhan || "‚Äî";
  $("p-concai").textContent = d.concai || "‚Äî";
  $("p-nhucau").textContent = d.nhucau || "‚Äî";
  $("p-huong").textContent  = d.huong  || "‚Äî";
  $("p-chitiet").textContent = d.chitiet || "‚Äî"; // M·ªöI

  $("p-bame").textContent   = d.bame   || "‚Äî";
  $("p-ace").textContent    = d.anhchiem || "‚Äî";
  $("p-mqh").textContent    = d.moiquanhe || "‚Äî";
  $("p-cv").textContent     = d.congviec || "‚Äî";
  $("p-tien").textContent   = d.tienmat || "‚Äî";
  $("p-nha").textContent    = d.nha || "‚Äî";
  $("p-xe").textContent     = d.xe  || "‚Äî";
  $("p-dat").textContent    = d.dat || "‚Äî";

  const tt = d.trangthai || "dang";
  const badge = $("p-trangthai");
  badge.textContent = tt === 'chet' ? 'ƒê√É CH·∫æT' : 'ƒêANG CHƒÇM';
  badge.style.borderColor = tt === 'chet' ? '#7f1d1d' : '#134e2a';
  badge.style.background  = tt === 'chet' ? '#3b0b0b' : '#052e1b';

  const thumb = $("thumb");
  thumb.innerHTML = '';
  const imgSrc = imageDataURL || active()?.image || "";
  if(imgSrc){
    const img = new Image();
    img.src = imgSrc; img.alt = d.ten || "";
    thumb.appendChild(img);
  } else {
    thumb.innerHTML = '<span style="font-size:12px;color:#9fb0c6;text-align:center;padding:6px">Ch∆∞a c√≥ ·∫£nh</span>';
  }
}

/* ====== Image handlers ====== */
$("file").addEventListener("change", (e)=>{
  const f = e.target.files[0]; if(!f) return;
  const r = new FileReader();
  r.onload = ()=>{ imageDataURL = r.result; autosave(); updatePreview(); };
  r.readAsDataURL(f);
});
$("imgurl").addEventListener("input", (e)=>{
  imageDataURL = e.target.value.trim(); autosave(); updatePreview();
});

/* ====== Lightbox ====== */
$("thumb").addEventListener("click", ()=>{
  const src = imageDataURL || active()?.image;
  if(!src) return;
  $("bigimg").src = src;
  $("lightbox").style.display='flex';
});
$("closeLb").addEventListener("click", ()=>{ $("lightbox").style.display='none'; });
$("lightbox").addEventListener("click", (e)=>{ if(e.target.id==='lightbox') $("lightbox").style.display='none'; });

/* ====== Buttons ====== */
$("capnhat").addEventListener("click", ()=>{ autosave(); updatePreview(); });
$("resetForm").addEventListener("click", ()=>{
  document.querySelectorAll('input, textarea, select').forEach(x=>{
    if(x.type==='file') x.value='';
    else if(x.tagName==='SELECT') x.selectedIndex=0;
    else x.value='';
  });
  imageDataURL=''; autosave(); updatePreview();
});

$("addTab").addEventListener("click", ()=>{
  profiles.push({id: uid(), name:`Kh√°ch ${profiles.length+1}`, data:{trangthai:"dang", nha:"Kh√¥ng r√µ", xe:"Kh√¥ng r√µ", dat:"Kh√¥ng r√µ"}, image:""});
  save(); current = profiles.length-1;
  renderTabs(); fillForm(active().data, active().image);
});
$("dupTab").addEventListener("click", ()=>{
  const a = active();
  const copy = JSON.parse(JSON.stringify(a));
  copy.id = uid(); copy.name = (a.name || "Kh√°ch") + " (b·∫£n sao)";
  profiles.splice(current+1, 0, copy);
  save(); current++; renderTabs(); fillForm(active().data, active().image);
});
$("delTab").addEventListener("click", ()=>{
  if(profiles.length===1){ alert("Ph·∫£i c√≤n √≠t nh·∫•t 1 tab."); return; }
  if(confirm("Xo√° tab hi·ªán t·∫°i?")){ profiles.splice(current,1); current = Math.max(0,current-1); save(); renderTabs(); fillForm(active().data, active().image); }
});

/* ====== Export Read-Only ====== */
$("exportRO").addEventListener("click", ()=>{
  autosave(); // d·ªØ li·ªáu m·ªõi nh·∫•t
  const p = active();
  const d = p.data || {};
  const img = p.image || "";

  const statusLabel = (d.trangthai==="chet") ? "ƒê√É CH·∫æT" : "ƒêANG CHƒÇM";
  const statusStyle = (d.trangthai==="chet")
    ? "border-color:#7f1d1d;background:#3b0b0b;"
    : "border-color:#134e2a;background:#052e1b;";

  const esc = (s)=>String(s||"‚Äî").replace(/</g,"&lt;");

  const html = `<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>${esc(d.ten||"Ho so")}</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:#0b1225;color:#e6eef8;margin:0;padding:20px}
  .card{max-width:800px;margin:0 auto;background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));border:1px solid #1f2937;border-radius:14px;overflow:hidden}
  .head{padding:16px 16px 0 16px}
  h1{margin:0 0 4px 0;font-size:22px}
  .sub{color:#b7c5d9;font-size:13px;margin-bottom:10px}
  .kv{margin:6px 16px;font-size:14px}
  .kv b{color:#dbe6f6}
  .row{display:grid;grid-template-columns:120px 1fr;gap:14px;padding:16px}
  .thumb{width:120px;height:120px;border:1px solid #1f2937;border-radius:10px;background:#0b1329;display:flex;align-items:center;justify-content:center;overflow:hidden}
  .thumb img{width:100%;height:100%;object-fit:cover}
  .status{display:inline-block;margin-left:8px;font-size:11px;padding:4px 8px;border-radius:999px;border:1px solid #1f2937}
  footer{color:#9fb0c6;text-align:center;font-size:12px;padding:14px}
</style>
</head>
<body>
  <div class="card">
    <div class="head">
      <h1>${esc(d.ten)}</h1>
      <div class="sub">NƒÉm sinh ${esc(d.namsinh)} ‚Ä¢ N∆°i ·ªü ${esc(d.noio)}</div>
      <div class="kv"><b>Ng√†y th·ª±c chi·∫øn:</b> ${esc(d.ngay)}
        <span class="status" style="${statusStyle}">${statusLabel}</span>
      </div>
    </div>
    <div class="row">
      <div class="thumb">${img?`<img src="${img}" alt="">`:`<span style="font-size:12px;color:#9fb0c6">Kh√¥ng c√≥ ·∫£nh</span>`}</div>
      <div>
        <div class="kv"><b>H√¥n nh√¢n:</b> ${esc(d.honnhan)}</div>
        <div class="kv"><b>Con c√°i:</b> ${esc(d.concai)}</div>
        <div class="kv"><b>Nhu c·∫ßu kh√°ch h√†ng:</b> ${esc(d.nhucau)}</div>
        <div class="kv"><b>ƒêang ƒëi h∆∞·ªõng:</b> ${esc(d.huong)}</div>
        <div class="kv"><b>Chi Ti·∫øt ch√∫ tr·ªçng:</b> ${esc(d.chitiet)}</div>
        <div class="kv"><b>Ba m·∫π:</b> ${esc(d.bame)}</div>
        <div class="kv"><b>Anh ch·ªã em:</b> ${esc(d.anhchiem)}</div>
        <div class="kv"><b>M·ªëi quan h·ªá:</b> ${esc(d.moiquanhe)}</div>
        <div class="kv"><b>C√¥ng vi·ªác:</b> ${esc(d.congviec)}</div>
        <div class="kv"><b>T√†i s·∫£n ti·ªÅn m·∫∑t:</b> ${esc(d.tienmat)}</div>
        <div class="kv"><b>C√≥ nh√†:</b> ${esc(d.nha)} ‚Ä¢ <b>C√≥ xe:</b> ${esc(d.xe)} ‚Ä¢ <b>C√≥ ƒë·∫•t:</b> ${esc(d.dat)}</div>
      </div>
    </div>
    <footer>Trang ch·ªâ ƒë·ªçc ƒë∆∞·ª£c xu·∫•t t·ª´ h·ªì s∆° ‚Äú${esc(p.name||"")}‚Äù.</footer>
  </div>
</body>
</html>`;

  const blob = new Blob([html], {type:"text/html;charset=utf-8"});
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  const safeName = (d.ten || p.name || "hoso").replace(/[^\p{L}\p{N}\-_.]+/gu,"_");
  a.download = `${safeName}.html`;
  a.click();                 // t·∫£i file
  window.open(url, "_blank"); // ƒë·ªìng th·ªùi m·ªü xem
  setTimeout(()=>URL.revokeObjectURL(url), 5000);
});

/* ====== Inputs auto-save (name -> tab label) ====== */
["ten","ngay","namsinh","noio","honnhan","concai","nhucau","huong","chitiet","bame","anhchiem","moiquanhe","congviec","tienmat","trangthai","nha","xe","dat"]
.forEach(id=>{
  const node = $(id);
  node.addEventListener("input", ()=>{
    autosave();
    if(id==="ten"){ renderTabs(); }
  });
});

/* ====== Init ====== */
load(); renderTabs(); fillForm(active().data, active().image);
</script>
</body>
</html>
